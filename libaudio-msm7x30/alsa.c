/*
I/ServiceManager(  150): Waiting for service media.audio_policy...
E/AudioHardwareMSM7X30( 1511): msm_mixer_open: Opening the device
E/AudioHardwareMSM7X30( 1511): msm_mixer_count:mixer_cnt =27
V/AudioHardwareMSM7X30( 1511): got device_count 18
V/AudioHardwareMSM7X30( 1511): index = 0
V/AudioHardwareMSM7X30( 1511): Found device: handset_rx:index = 0,dev_id: 0
V/AudioHardwareMSM7X30( 1511): class ID = 0,capablity = 5 for device 0
V/AudioHardwareMSM7X30( 1511): index = 1
V/AudioHardwareMSM7X30( 1511): Found device: handset_tx:index = 1,dev_id: 1
V/AudioHardwareMSM7X30( 1511): class ID = 0,capablity = 6 for device 1
V/AudioHardwareMSM7X30( 1511): index = 4
V/AudioHardwareMSM7X30( 1511): Found device: headset_stereo_rx:index = 4,dev_id: 2
V/AudioHardwareMSM7X30( 1511): class ID = 0,capablity = 5 for device 2
V/AudioHardwareMSM7X30( 1511): index = 5
V/AudioHardwareMSM7X30( 1511): Found device: headset_mono_tx:index = 5,dev_id: 3
V/AudioHardwareMSM7X30( 1511): class ID = 0,capablity = 6 for device 3
V/AudioHardwareMSM7X30( 1511): index = 6
V/AudioHardwareMSM7X30( 1511): Found device: fmradio_handset_rx:index = 6,dev_id: 4
V/AudioHardwareMSM7X30( 1511): class ID = 0,capablity = 17 for device 4
V/AudioHardwareMSM7X30( 1511): index = 2
V/AudioHardwareMSM7X30( 1511): Found device: speaker_stereo_rx:index = 2,dev_id: 5
V/AudioHardwareMSM7X30( 1511): class ID = 0,capablity = 5 for device 5
V/AudioHardwareMSM7X30( 1511): index = 8
V/AudioHardwareMSM7X30( 1511): Found device: fmradio_speaker_rx:index = 8,dev_id: 6
V/AudioHardwareMSM7X30( 1511): class ID = 0,capablity = 17 for device 6
V/AudioHardwareMSM7X30( 1511): index = 7
V/AudioHardwareMSM7X30( 1511): Found device: fmradio_headset_rx:index = 7,dev_id: 7
V/AudioHardwareMSM7X30( 1511): class ID = 0,capablity = 17 for device 7
V/AudioHardwareMSM7X30( 1511): index = 12
V/AudioHardwareMSM7X30( 1511): Found device: tty_headset_mono_tx:index = 12,dev_id: 8
V/AudioHardwareMSM7X30( 1511): class ID = 0,capablity = 38 for device 8
V/AudioHardwareMSM7X30( 1511): index = 11
V/AudioHardwareMSM7X30( 1511): Found device: tty_headset_mono_rx:index = 11,dev_id: 9
V/AudioHardwareMSM7X30( 1511): class ID = 0,capablity = 37 for device 9
V/AudioHardwareMSM7X30( 1511): index = 3
V/AudioHardwareMSM7X30( 1511): Found device: speaker_mono_tx:index = 3,dev_id: 10
V/AudioHardwareMSM7X30( 1511): class ID = 0,capablity = 6 for device 10
V/AudioHardwareMSM7X30( 1511): index = 9
V/AudioHardwareMSM7X30( 1511): Found device: handset_dual_mic_broadside_tx:index = 9,dev_id: 11
V/AudioHardwareMSM7X30( 1511): class ID = 0,capablity = 6 for device 11
V/AudioHardwareMSM7X30( 1511): index = 10
V/AudioHardwareMSM7X30( 1511): Found device: speaker_dual_mic_broadside_tx:index = 10,dev_id: 12
V/AudioHardwareMSM7X30( 1511): class ID = 0,capablity = 6 for device 12
V/AudioHardwareMSM7X30( 1511): index = 16
V/AudioHardwareMSM7X30( 1511): Found device: handset_secondary_mic_tx:index = 16,dev_id: 13
V/AudioHardwareMSM7X30( 1511): class ID = 0,capablity = 6 for device 13
V/AudioHardwareMSM7X30( 1511): index = 15
V/AudioHardwareMSM7X30( 1511): Found device: headset_stereo_speaker_stereo_rx:index = 15,dev_id: 14
V/AudioHardwareMSM7X30( 1511): class ID = 0,capablity = 5 for device 14
V/AudioHardwareMSM7X30( 1511): index = 17
V/AudioHardwareMSM7X30( 1511): Found device: speaker_music_rx:index = 17,dev_id: 15
V/AudioHardwareMSM7X30( 1511): class ID = 0,capablity = 5 for device 15
V/AudioHardwareMSM7X30( 1511): index = 13
V/AudioHardwareMSM7X30( 1511): Found device: bt_sco_rx:index = 13,dev_id: 16
V/AudioHardwareMSM7X30( 1511): class ID = 1,capablity = 5 for device 16
V/AudioHardwareMSM7X30( 1511): index = 14
V/AudioHardwareMSM7X30( 1511): Found device: bt_sco_tx:index = 14,dev_id: 17
V/AudioHardwareMSM7X30( 1511): class ID = 1,capablity = 6 for device 17
D/AudioHardwareInterface( 1511): setMode(NORMAL)
I/AudioHardwareMSM7X30( 1511): Set master volume to 7.
V/AudioHardwareMSM7X30( 1511): set_volume_rpc(0, 0, 7)
V/AudioHardwareMSM7X30( 1511): set_volume_rpc(1, 0, 7)
V/AudioHardwareMSM7X30( 1511): set_volume_rpc(6, 0, 7)
V/AudioHardwareMSM7X30( 1511): set_volume_rpc(2, 0, 7)
I/CameraService( 1511): CameraService started (pid=1511)
V/AudioPolicyService( 1511): Using hardware specific audio policy
V/AudioFlinger( 1511): registerClient() client 0xf4c8, pid 1511
V/AudioFlinger( 1511): openOutput(), Device 2, SamplingRate 0, Format 0, Channels 0, flags 0
V/AudioFlinger( 1511): openOutput() openOutputStream returned output 0xf538, SamplingRate 44100, Format 1, Channels c, status 0
V/AudioFlinger( 1511): openOutput() created mixer output: ID 1 thread 0xf558
V/AudioFlinger( 1511): PlaybackThread::audioConfigChanged_l, thread 0xf558, event 0, param 0
V/AudioPolicyManagerBase( 1511): setOutputDevice() output 1 device 2 delayMs 0
V/AudioPolicyService( 1511): inserting command: 3 at index 0, num commands 0
V/AudioPolicyService( 1511): AudioCommandThread() adding set parameter string routing=2, io 1 ,delay 0
V/AudioPolicyService( 1511): AudioCommandThread() processing set parameters string routing=2, io 1
D/AudioFlinger( 1511): setParameters(): io 1, keyvalue routing=2, tid 1513, calling tid 1511
V/AudioFlinger( 1511): ThreadBase::setParameters() routing=2
I/AudioFlinger( 1511): AudioFlinger's thread 0xf558 ready to run
V/AudioHardwareMSM7X30( 1511): AudioStreamOutMSM72xx::setParameters() routing=2
V/AudioHardwareMSM7X30( 1511): set output routing 2
I/AudioHardwareMSM7X30( 1511): Routing audio to Speakerphone for music
V/AudioHardwareMSM7X30( 1511): doAudioRouteOrMute() device 10, mMode 0, mMicMute 1
V/AudioHardwareMSM7X30( 1511): do_route_audio_rpc(16, 1, 1)
V/AudioHardwareMSM7X30( 1511): hw.secondary_mic(0)
V/AudioHardwareMSM7X30( 1511): In SPEAKER_MUSIC
E/AudioHardwareMSM7X30( 1511): new_rx = 15
E/AudioHardwareMSM7X30( 1511): new_tx = 10
E/AudioHardwareMSM7X30( 1511): else with updateDeviceInfo
E/AudioHardwareMSM7X30( 1511): simple device switch
V/AudioPolicyManagerBase( 1511): applyStreamVolumes() for output 1 and device 2
V/AudioPolicyManagerBase( 1511): setStreamVolume() for output 1 stream 0, volume 1.000000, delay 0
V/AudioPolicyService( 1511): inserting command: 2 at index 0, num commands 0
V/AudioPolicyService( 1511): AudioCommandThread() adding set volume stream 0, volume 1.000000, output 1
V/AudioPolicyService( 1511): AudioCommandThread() processing set volume stream 0,                             volume 1.000000, output 1
V/AudioPolicyService( 1511): inserting command: 4 at index 0, num commands 0
V/AudioPolicyService( 1511): AudioCommandThread() adding set voice volume volume 1.000000
V/AudioPolicyService( 1511): AudioCommandThread() processing set voice volume volume 1.000000
D/AudioHardwareMSM7X30( 1511): setVoiceVolume(1.000000)
I/AudioHardwareMSM7X30( 1511): Setting in-call volume to 100 (available range is 0 to 100)
V/AudioHardwareMSM7X30( 1511): msm_set_voice_rx_vol(100) succeeded
V/AudioPolicyManagerBase( 1511): setStreamVolume() for output 1 stream 1, volume 1.000000, delay 0
V/AudioPolicyService( 1511): inserting command: 2 at index 0, num commands 0
V/AudioPolicyService( 1511): AudioCommandThread() adding set volume stream 1, volume 1.000000, output 1
V/AudioPolicyService( 1511): AudioCommandThread() processing set volume stream 1,                             volume 1.000000, output 1
V/AudioPolicyManagerBase( 1511): setStreamVolume() for output 1 stream 2, volume 1.000000, delay 0
V/AudioPolicyService( 1511): inserting command: 2 at index 0, num commands 0
V/AudioPolicyService( 1511): AudioCommandThread() adding set volume stream 2, volume 1.000000, output 1
V/AudioPolicyService( 1511): AudioCommandThread() processing set volume stream 2,                             volume 1.000000, output 1
V/AudioPolicyManagerBase( 1511): setStreamVolume() for output 1 stream 3, volume 1.000000, delay 0
V/AudioPolicyService( 1511): inserting command: 2 at index 0, num commands 0
V/AudioPolicyService( 1511): AudioCommandThread() adding set volume stream 3, volume 1.000000, output 1
V/AudioPolicyService( 1511): AudioCommandThread() processing set volume stream 3,                             volume 1.000000, output 1
V/AudioPolicyManagerBase( 1511): setStreamVolume() for output 1 stream 4, volume 1.000000, delay 0
V/AudioPolicyService( 1511): inserting command: 2 at index 0, num commands 0
V/AudioPolicyService( 1511): AudioCommandThread() adding set volume stream 4, volume 1.000000, output 1
V/AudioPolicyService( 1511): AudioCommandThread() processing set volume stream 4,                             volume 1.000000, output 1
V/AudioPolicyManagerBase( 1511): setStreamVolume() for output 1 stream 5, volume 1.000000, delay 0
V/AudioPolicyService( 1511): inserting command: 2 at index 0, num commands 0
V/AudioPolicyService( 1511): AudioCommandThread() adding set volume stream 5, volume 1.000000, output 1
V/AudioPolicyService( 1511): AudioCommandThread() processing set volume stream 5,                             volume 1.000000, output 1
V/AudioPolicyManagerBase( 1511): checkAndSetVolume() cannot set stream 6 volume with force use = 0 for comm
V/AudioPolicyManagerBase( 1511): setStreamVolume() for output 1 stream 7, volume 1.000000, delay 0
V/AudioPolicyService( 1511): inserting command: 2 at index 0, num commands 0
V/AudioPolicyService( 1511): AudioCommandThread() adding set volume stream 7, volume 1.000000, output 1
V/AudioPolicyService( 1511): AudioCommandThread() processing set volume stream 7,                             volume 1.000000, output 1
V/AudioPolicyManagerBase( 1511): setStreamVolume() for output 1 stream 8, volume 1.000000, delay 0
V/AudioPolicyService( 1511): inserting command: 2 at index 0, num commands 0
V/AudioPolicyService( 1511): AudioCommandThread() adding set volume stream 8, volume 1.000000, output 1
V/AudioPolicyService( 1511): AudioCommandThread() processing set volume stream 8,                             volume 1.000000, output 1
V/AudioPolicyManagerBase( 1511): setStreamVolume() for output 1 stream 9, volume 1.000000, delay 0
V/AudioPolicyService( 1511): inserting command: 2 at index 0, num commands 0
V/AudioPolicyService( 1511): AudioCommandThread() adding set volume stream 9, volume 1.000000, output 1
V/AudioPolicyService( 1511): AudioCommandThread() processing set volume stream 9,                             volume 1.000000, output 1
V/AudioPolicyManagerBase( 1511): getDeviceForStrategy() strategy 0, device 2
V/AudioPolicyManagerBase( 1511): getDeviceForStrategy() strategy 1, device 1
V/AudioPolicyManagerBase( 1511): getDeviceForStrategy() strategy 2, device 2
V/AudioPolicyManagerBase( 1511): getDeviceForStrategy() strategy 0, device 2
V/AudioPolicyManagerBase( 1511): getDeviceForStrategy() strategy 3, device 2
V/AudioPolicyManagerBase( 1511): setSystemProperty() property ro.camera.sound.forced, value 0
V/AudioPolicyManagerBase( 1511): ENFORCED_AUDIBLE can be muted
V/AudioPolicyService( 1511): AudioCommandThread() going to sleep
V/AudioFlinger( 1511): Audio hardware entering standby, mixer 0xf558, mSuspended 0
V/AudioHardwareMSM7X30( 1511): Out::standby()
V/AudioFlinger( 1511): MixerThread 0xf558 TID 1514 going to sleep
V/AudioPolicyService( 1511): AudioCommandThread() going to sleep
V/AudioPolicyManagerBase( 1511): initStreamVolume() stream 0, min 0, max 15
V/AudioPolicyManagerBase( 1511): setStreamVolumeIndex() stream 0, index 15
V/AudioPolicyManagerBase( 1511): initStreamVolume() stream 1, min 0, max 7
V/AudioPolicyManagerBase( 1511): setStreamVolumeIndex() stream 1, index 7
V/AudioPolicyManagerBase( 1511): initStreamVolume() stream 2, min 0, max 7
V/AudioPolicyManagerBase( 1511): setStreamVolumeIndex() stream 2, index 5
V/AudioPolicyManagerBase( 1511): setStreamVolume() for output 1 stream 2, volume 0.188365, delay 0
V/AudioPolicyService( 1511): inserting command: 2 at index 0, num commands 0
V/AudioPolicyService( 1511): AudioCommandThread() adding set volume stream 2, volume 0.188365, output 1
V/AudioPolicyService( 1511): AudioCommandThread() waking up
V/AudioPolicyService( 1511): AudioCommandThread() processing set volume stream 2,                             volume 0.188365, output 1
V/AudioPolicyService( 1511): AudioCommandThread() going to sleep
V/AudioPolicyManagerBase( 1511): initStreamVolume() stream 3, min 0, max 25
V/AudioPolicyManagerBase( 1511): setStreamVolumeIndex() stream 3, index 12
V/AudioPolicyManagerBase( 1511): setStreamVolume() for output 1 stream 3, volume 0.050119, delay 0
V/AudioPolicyService( 1511): inserting command: 2 at index 0, num commands 0
V/AudioPolicyService( 1511): AudioCommandThread() adding set volume stream 3, volume 0.050119, output 1
V/AudioPolicyService( 1511): AudioCommandThread() waking up
V/AudioPolicyService( 1511): AudioCommandThread() processing set volume stream 3,                             volume 0.050119, output 1
V/AudioPolicyService( 1511): AudioCommandThread() going to sleep
V/AudioPolicyManagerBase( 1511): initStreamVolume() stream 4, min 0, max 7
V/AudioPolicyManagerBase( 1511): setStreamVolumeIndex() stream 4, index 6
V/AudioPolicyManagerBase( 1511): setStreamVolume() for output 1 stream 4, volume 0.421696, delay 0
V/AudioPolicyService( 1511): inserting command: 2 at index 0, num commands 0
V/AudioPolicyService( 1511): AudioCommandThread() adding set volume stream 4, volume 0.421696, output 1
V/AudioPolicyService( 1511): AudioCommandThread() waking up
V/AudioPolicyService( 1511): AudioCommandThread() processing set volume stream 4,                             volume 0.421696, output 1
V/AudioPolicyService( 1511): AudioCommandThread() going to sleep
V/AudioPolicyManagerBase( 1511): initStreamVolume() stream 5, min 0, max 7
V/AudioPolicyManagerBase( 1511): setStreamVolumeIndex() stream 5, index 5
V/AudioPolicyManagerBase( 1511): setStreamVolume() for output 1 stream 5, volume 0.188365, delay 0
V/AudioPolicyService( 1511): inserting command: 2 at index 0, num commands 0
V/AudioPolicyService( 1511): AudioCommandThread() adding set volume stream 5, volume 0.188365, output 1
V/AudioPolicyService( 1511): AudioCommandThread() waking up
V/AudioPolicyService( 1511): AudioCommandThread() processing set volume stream 5,                             volume 0.188365, output 1
V/AudioPolicyService( 1511): AudioCommandThread() going to sleep
V/AudioPolicyManagerBase( 1511): initStreamVolume() stream 6, min 0, max 15
V/AudioPolicyManagerBase( 1511): setStreamVolumeIndex() stream 6, index 15
V/AudioPolicyManagerBase( 1511): checkAndSetVolume() cannot set stream 6 volume with force use = 0 for comm
V/AudioPolicyManagerBase( 1511): initStreamVolume() stream 7, min 0, max 7
V/AudioPolicyManagerBase( 1511): setStreamVolumeIndex() stream 7, index 7
V/AudioPolicyManagerBase( 1511): initStreamVolume() stream 8, min 0, max 15
V/AudioPolicyManagerBase( 1511): setStreamVolumeIndex() stream 8, index 15
V/AudioPolicyManagerBase( 1511): initStreamVolume() stream 9, min 0, max 25
V/AudioPolicyManagerBase( 1511): setStreamVolumeIndex() stream 9, index 12
V/AudioPolicyManagerBase( 1511): setStreamVolume() for output 1 stream 9, volume 0.050119, delay 0
V/AudioPolicyService( 1511): inserting command: 2 at index 0, num commands 0
V/AudioPolicyService( 1511): AudioCommandThread() adding set volume stream 9, volume 0.050119, output 1
V/AudioPolicyService( 1511): AudioCommandThread() waking up
V/AudioPolicyService( 1511): AudioCommandThread() processing set volume stream 9,                             volume 0.050119, output 1
V/AudioPolicyService( 1511): AudioCommandThread() going to sleep
V/AudioPolicyManagerBase( 1511): setStreamVolumeIndex() stream 5, index 5
V/AudioPolicyManagerBase( 1511): setStreamVolumeIndex() stream 7, index 7
V/AudioPolicyManagerBase( 1511): setStreamVolumeIndex() stream 8, index 15

*/
#include <sys/types.h>
#include <sys/stat.h>
#include <sys/ioctl.h>

#include <fcntl.h>
#include <unistd.h>
#include <stdio.h>
#include <errno.h>
#include "asound.h"
#define LOG_TAG "LibAudioAlsa"
#define LOG_NDEBUG 0
#include <utils/Log.h>

#define MAX_DEVICES 64

struct mixer_device_t {
    int id;
    char name[64];
    int class_id;
    int capability;
    int elem_id;
};

static int device_count;

static char *device_list[MAX_DEVICES];

static struct mixer_device_t mixer_device[MAX_DEVICES];

#define NO_OF_CTRLS 9

enum ctrls {COUNT,STREAM,RECORD,VOICE,VOLUME,VOICEVOLUME,VOICEMUTE,VOICECALL,DEVICEVOLUME};
static const char *ctrl_names[NO_OF_CTRLS]={"Count","Stream","Record","Voice",
	"Volume","VoiceVolume","VoiceMute","Voice Call","Device_Volume"};

static int ctrls[NO_OF_CTRLS]; 

struct mixer_ctl_t {
    struct mixer *mixer;
    struct snd_ctl_elem_info *info;
    char **ename;
};

struct mixer_t {
    int fd;
    struct snd_ctl_elem_info *info;
    struct mixer_ctl_t *ctl;
    unsigned count;
} mymixer;

static struct mixer_t *mixer=&mymixer;

int msm_mixer_count() {
    int ret;
    struct snd_ctl_elem_list elist;
    elist.offset=0;
    elist.space=0;

    ret=ioctl(mixer->fd,SNDRV_CTL_IOCTL_ELEM_LIST,&elist);
    if (ret<0)
        LOGE("get elist failed %d %d",ret, errno);
    LOGI("got elist %d", elist.count);

    return elist.count;
}

void elem_write(int id,int v,int v1,int v2) {
    struct snd_ctl_elem_value elval;
    int ret;
    
    elval.id.numid=id;
    elval.indirect=0;
    elval.value.integer.value[0]=v;
    elval.value.integer.value[1]=v1;
    elval.value.integer.value[2]=v2;
    ret=ioctl(mixer->fd,SNDRV_CTL_IOCTL_ELEM_WRITE,&elval);
    if(ret<0)
	    LOGE("elem_write failed %d", errno);
}
   


int msm_mixer_open(const char *name,int card) {
    int n,m,i,j;
    struct snd_ctl_elem_id *eid = NULL;
    struct snd_ctl_elem_list elist;
    struct snd_ctl_elem_info einfo;
    struct snd_ctl_elem_value elval;

    int ret;

    mixer->fd=open(name, O_RDWR, 0);

    LOGI("opened mixer %d %s %d",mixer->fd,name,card);

    mixer->count=msm_mixer_count();

    elist.offset=0;
    elist.space=mixer->count;
    elist.pids=malloc(sizeof(struct snd_ctl_elem_id)*elist.space);
    device_count=0;
    ret=ioctl(mixer->fd,SNDRV_CTL_IOCTL_ELEM_LIST,&elist);
    if (ret<0)
        LOGE("get elist failed %d %d",ret, errno);
    LOGD("got elist %d", elist.count);
    for (i=0;i<mixer->count;i++) {
        LOGD("id %d name %s: %d %d %d %x",elist.pids[i].numid,elist.pids[i].name, elist.pids[i].device, elist.pids[i].subdevice, elist.pids[i].index ,elist.pids[i].iface);
        einfo.id.numid=elist.pids[i].numid;
        ret=ioctl(mixer->fd,SNDRV_CTL_IOCTL_ELEM_INFO,&einfo);
        if (ret<0)
            LOGE("get einfo failed %d %d",ret, errno);
        LOGD("einfo type %d %d %d %d %d",einfo.type, einfo.access, einfo.count, einfo.value.integer.min, einfo.value.integer.max);
        elval.id.numid=elist.pids[i].numid;
        elval.indirect=0;
	elval.value.integer.value[0]=0;
	elval.value.integer.value[1]=0;
	elval.value.integer.value[2]=0;
        ret=ioctl(mixer->fd,SNDRV_CTL_IOCTL_ELEM_READ,&elval);
        if (ret<0)
            LOGE("get eval failed %d %d",ret, errno);
        LOGD("eval %d %d %d",elval.value.integer.value[0],elval.value.integer.value[1],elval.value.integer.value[2]);
	for(j=0;j<NO_OF_CTRLS;j++)
		if(!strcmp(elist.pids[i].name,ctrl_names[j]))
			ctrls[j]=elist.pids[i].numid;
	if(i>=NO_OF_CTRLS) {
		mixer_device[device_count].id=device_count;
		mixer_device[device_count].elem_id=elist.pids[i].numid;
		mixer_device[device_count].class_id=elval.value.integer.value[0];
		mixer_device[device_count].capability=elval.value.integer.value[1];
		strcpy(mixer_device[device_count].name, elist.pids[i].name);
		device_list[device_count]=&mixer_device[device_count].name;
		device_count++;
	}
    }
    for(i=0;i<NO_OF_CTRLS;i++)
	    LOGD("ctrl %s=%d",ctrl_names[i],ctrls[i]);
    return 0;
fail:
    LOGE("Failed");
    return 0;

}

int msm_mixer_close() {
    close(mixer->fd);
    return 0;
}
int msm_get_device(const char *name) {
    int i;
    for(i=0;i<device_count;i++)
	    if(!strcmp(mixer_device[i].name,name))
		    return mixer_device[i].id;
    return 0;
}
int msm_en_device(int dev_id,int set) {
    LOGD("Enable device %d %d", dev_id,set);
    elem_write(mixer_device[dev_id].elem_id,set,0,0);
    return 0;
}
int msm_route_stream(int dir, int dec_id, int dev_id, int set) {
    LOGD("Route Stream %d %d %d %d",dir,dec_id,dev_id,set);
    if(dir==1) // PCM_PLAY
	elem_write(ctrls[STREAM],dec_id,dev_id,set);
    else
	elem_write(ctrls[RECORD],dec_id,dev_id,set);
    return 0;
}
int msm_route_voice(int rx,int tx,int set) {
    LOGD("Route Voice %d %d %d",tx,rx,set);
    elem_write(ctrls[VOICE],rx,tx,set);  // tx and rx seem to be swapped here!
    return 0;
}
int msm_set_volume(int dec_id, int vol) {
    LOGD("Set Volume %d %d",dec_id,vol);
    elem_write(ctrls[VOLUME], dec_id, vol, 0);
    return 0;
}
int msm_get_device_class(int device_id) {
    return mixer_device[device_id].class_id;
}
int msm_get_device_capability(int device_id) {
    return mixer_device[device_id].capability;
}
const char **msm_get_device_list() {
    return device_list;
}
int msm_get_device_count() {
    return device_count;
}
int msm_start_voice() {
    LOGD("Start Voice");
    elem_write(ctrls[VOICECALL], 1,0,0);
    return 0;
}
int msm_end_voice() {
    LOGD("End Voice");
    elem_write(ctrls[VOICECALL], 0,0,0);
    return 0;
}
int msm_set_voice_tx_mute(int mute) {
    LOGD("Set Voice tx Mute %d",mute);
    elem_write(ctrls[VOICEMUTE], 2,mute,0);
    return 0;
}
int msm_set_voice_rx_vol(int volume) {
    LOGD("Set Voice rx Volume %d",volume);
    elem_write(ctrls[VOICEVOLUME], 1, volume,0);
    return 0;
}
int msm_set_device_volume(int dev_id,int volume) {
    LOGD("Set Device Volume %d %d",dev_id, volume);
    elem_write(ctrls[DEVICEVOLUME], dev_id, volume,0);
    return 0;
}
int msm_reset_all_device() {
    return 0;
}

#ifdef __cplusplus
}
#endif
